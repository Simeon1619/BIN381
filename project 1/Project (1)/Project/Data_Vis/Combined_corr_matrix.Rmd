#install.packages(c("tidyverse", "readxl", "janitor"))
# Load libraries
library(tidyverse)
library(readxl)
library(janitor)

# 1. Define file paths
files <- list.files(path = "C:/Users/faase/OneDrive/Desktop/BIN/Project/Datasets_Clean", pattern = "*.csv", full.names = TRUE)
list(files)

all_data <- files %>%
  map_df(~ read_csv(.x, col_types = cols(.default = col_character())) %>%
           clean_names() %>%
           mutate(source_file = basename(.x))
  )
all_data <- all_data %>%
  mutate(value = as.numeric(value))


# 3. Quick structure check
glimpse(all_data)
names(all_data)

# 4. Filter for key indicators of interest
key_terms <- c("mortality", "vaccin", "breastfeed", "ARI", "facility", "BMI", "stunted", "wasted")
filtered_data <- all_data %>%
  filter(str_detect(tolower(indicator), paste(key_terms, collapse = "|")))

# 5. Summary statistics
summary_stats <- filtered_data %>%
  group_by(indicator, survey_year) %>%
  summarise(mean_value = mean(value, na.rm = TRUE),
            min_value = min(value, na.rm = TRUE),
            max_value = max(value, na.rm = TRUE),
            .groups = "drop")

# 6. Trend visualisation example
filtered_data %>%
  ggplot(aes(x = survey_year, y = value, color = indicator)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Health Indicators Over Time",
       x = "Survey Year", y = "Value (%)")

# 7. Correlation between indicators (wide format)
wide_data <- filtered_data %>%
  select(survey_year, indicator, value) %>%
  pivot_wider(names_from = indicator, values_from = value)

cor_matrix <- cor(wide_data %>% select(-survey_year), use = "pairwise.complete.obs")
print(cor_matrix)